# custom-backtest-parameters Specification Delta

## MODIFIED Requirements

### Requirement: 自定义网格参数编辑器
前端应用必须(SHALL)提供网格参数设置界面，允许用户手动配置网格策略参数和手续费参数。

#### Scenario: 面板默认展开显示
- **WHEN** 用户进入回测分析页面时
- **THEN** 网格参数设置面板默认展开显示
- **AND** 仅显示网格参数设置，不显示手续费相关参数
- **AND** 无需用户手动点击展开按钮

#### Scenario: 编辑手续费模式切换
- **WHEN** 用户点击面板右上角的"编辑手续费"按钮时
- **THEN** 切换到手续费编辑状态
- **AND** 隐藏网格参数显示界面
- **AND** 仅显示手续费相关参数的编辑界面（手续费率、最低收费、无风险利率、年交易日数）

#### Scenario: 编辑模式完成
- **WHEN** 用户在手续费编辑模式中点击保存或取消时
- **THEN** 返回网格参数显示模式
- **AND** 恢复网格参数的完整显示

#### Scenario: 统一面板显示
- **WHEN** 用户查看网格参数设置时
- **THEN** 显示标题为"网格参数设置"的统一面板
- **AND** 默认仅展示网格策略参数，不展示手续费相关参数

#### Scenario: 参数实时验证
- **WHEN** 用户修改参数值时
- **THEN** 立即验证参数的有效性
- **AND** 显示验证错误信息和建议修正值
- **AND** 验证适用于网格参数和手续费参数

#### Scenario: 参数范围验证
- **WHEN** 用户修改任何参数值时
- **THEN** 实时验证以下规则：
  - 价格区间比例：5%-100%
  - 投资金额：1000-1000万元
  - 网格步长不超过价格区间的50%
  - 单笔交易金额不超过总金额
  - 日期范围：30-120天
- **AND** 显示具体的验证错误信息
- **AND** 禁用保存按钮直到所有参数有效

#### Scenario: 参数应用和重测
- **WHEN** 用户点击"保存并重新回测"按钮时
- **THEN** 使用所有自定义参数重新执行回测分析
- **AND** 立即更新显示新的回测结果
- **AND** 参数包括网格参数和手续费参数

### Requirement: 参数持久化和恢复
应用必须(SHALL)支持所有自定义参数的会话级持久化，包括网格参数和手续费参数。

#### Scenario: 统一参数缓存
- **WHEN** 用户设置任何自定义参数时
- **THEN** 将所有参数存储在会话存储中
- **AND** 使用分析特定的缓存键包含所有参数类型

#### Scenario: 统一参数恢复
- **WHEN** 用户重新访问分析页面时
- **THEN** 从缓存中恢复上次使用的所有自定义参数
- **AND** 在参数无效时回退到默认参数

## ADDED Requirements

### Requirement: 手续费参数编辑支持
应用必须(SHALL)支持手续费相关参数的编辑和配置。

#### Scenario: 手续费率配置
- **WHEN** 用户编辑手续费率时
- **THEN** 支持0.001%-10%范围内的配置
- **AND** 默认值为0.02%

#### Scenario: 最低收费配置
- **WHEN** 用户编辑最低收费时
- **THEN** 支持1-100元范围内的配置
- **AND** 默认值为5元

#### Scenario: 无风险利率配置
- **WHEN** 用户编辑无风险利率时
- **THEN** 支持0.01%-20%范围内的配置
- **AND** 默认值为3%

#### Scenario: 年交易日数配置
- **WHEN** 用户编辑年交易日数时
- **THEN** 支持200-300天范围内的配置
- **AND** 默认值为244天