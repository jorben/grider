# ETFç½‘æ ¼äº¤æ˜“å›æµ‹åŠŸèƒ½ - éœ€æ±‚æ–‡æ¡£ v2.0

## ğŸ“Œ åŠŸèƒ½æ¦‚è¿°

åœ¨ç½‘æ ¼äº¤æ˜“ç­–ç•¥åˆ†æç³»ç»Ÿä¸­æ–°å¢**å›æµ‹åˆ†æ**åŠŸèƒ½ï¼ŒåŸºäºå·²ç”Ÿæˆçš„ç½‘æ ¼å‚æ•°ï¼Œä½¿ç”¨å†å²5åˆ†é’ŸKçº¿æ•°æ®è¿›è¡Œç­–ç•¥å›æµ‹ï¼Œå¸®åŠ©ç”¨æˆ·è¯„ä¼°ç­–ç•¥çš„å†å²è¡¨ç°ã€‚

---

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

### 1. æ•°æ®æº

#### è¡Œæƒ…æ•°æ®
- **æ•°æ®ç±»å‹**ï¼š5åˆ†é’ŸKçº¿å†å²æ•°æ®
- **æ•°æ®æä¾›å•†**ï¼šTsanghiProvider
- **æ•°æ®å­—æ®µ**ï¼š`ticker, date, open, high, low, close, volume, amount`
- **æ•°æ®æ¥å£**ï¼š
  - ETFï¼š`get_etf_5min(ticker, exchange_code, start_date, end_date)`
  - è‚¡ç¥¨ï¼š`get_stock_5min(ticker, exchange_code, start_date, end_date)`

#### äº¤æ˜“æ—¥å†
- **æ¥å£**ï¼š`get_calendar(exchange_code, limit)`
- **ç”¨é€”**ï¼šè·å–æœ€è¿‘Nä¸ªæœ‰æ•ˆäº¤æ˜“æ—¥
- **å½“å‰é…ç½®**ï¼šæœ€è¿‘5ä¸ªäº¤æ˜“æ—¥
- **æ‰©å±•æ€§**ï¼šåç«¯å¯é…ç½®ï¼Œæœªæ¥å¯æ‰©å±•åˆ°30ä¸ªäº¤æ˜“æ—¥æˆ–æ›´é•¿

### 2. å±•ç¤ºä½ç½®

åœ¨åˆ†ææŠ¥å‘Šé¡µé¢æ–°å¢**ç¬¬4ä¸ªæ ‡ç­¾é¡µ**ï¼š
```
[æ¦‚è§ˆ] [é€‚å®œåº¦è¯„ä¼°] [ç½‘æ ¼ç­–ç•¥] [å›æµ‹åˆ†æ] â† æ–°å¢
```

---

## ğŸ’° å›æµ‹æ ¸å¿ƒé€»è¾‘

### åˆå§‹åŒ–é˜¶æ®µ

#### 1. å»ºä»“é€»è¾‘
- **åº•ä»“å»ºä»“**ï¼š
  - æŒ‰ç­–ç•¥çš„**åˆå§‹åŸºå‡†ä»·æ ¼**ï¼ˆ`current_price`ï¼‰ä¸€æ¬¡æ€§å»ºä»“
  - å»ºä»“è‚¡æ•° = `base_position_shares`ï¼ˆä»ç½‘æ ¼ç­–ç•¥è·å–ï¼‰
  - å»ºä»“æˆæœ¬ = åŸºå‡†ä»·æ ¼ Ã— åº•ä»“è‚¡æ•° Ã— (1 + æ‰‹ç»­è´¹ç‡)

- **åˆå§‹çŠ¶æ€**ï¼š
  - æŒä»“è‚¡æ•° = åº•ä»“è‚¡æ•°
  - å¯ç”¨èµ„é‡‘ = æ€»èµ„é‡‘ - åº•ä»“æˆæœ¬
  - å½“å‰åŸºå‡†ä»· = ç­–ç•¥åˆå§‹åŸºå‡†ä»·
  - å½“å‰ä¹°å…¥ç‚¹ = åŸºå‡†ä»· - æ­¥é•¿
  - å½“å‰å–å‡ºç‚¹ = åŸºå‡†ä»· + æ­¥é•¿

#### 2. ä»·æ ¼åç¦»å¤„ç†ï¼ˆç½‘æ ¼å€æ•°æˆäº¤æœºåˆ¶ï¼‰
å¦‚æœå›æµ‹å¼€å§‹æ—¶çš„å®é™…ä»·æ ¼åç¦»ç­–ç•¥åŸºå‡†ä»·ï¼š
- **è®¡ç®—åç¦»æ¡£ä½**ï¼š
  ```python
  åç¦»æ¡£ä½ = floor((åŸºå‡†ä»· - å®é™…ä»·æ ¼) / æ­¥é•¿)
  ```
- **è§¦å‘å€æ•°æˆäº¤**ï¼š
  - è‹¥åç¦»æ¡£ä½ > 0ï¼šè§¦å‘Nå€ä¹°å…¥ï¼ˆN = åç¦»æ¡£ä½ï¼‰
  - è‹¥åç¦»æ¡£ä½ < 0ï¼šè§¦å‘|N|å€å–å‡ºï¼ˆN = åç¦»æ¡£ä½ï¼‰
  - ç¤ºä¾‹ï¼šåŸºå‡†ä»·10å…ƒï¼Œæ­¥é•¿1å…ƒï¼Œå®é™…ä»·8å…ƒ â†’ è§¦å‘2å€ä¹°å…¥

- **æ›´æ–°çŠ¶æ€**ï¼š
  - æ›´æ–°æŒä»“å’Œèµ„é‡‘
  - æ›´æ–°åŸºå‡†ä»·ä¸ºæœ€è¿‘æˆäº¤ä»·
  - é‡æ–°è®¡ç®—ä¸‹ä¸€ä¸ªä¹°å–ç‚¹

### äº¤æ˜“æ‰§è¡Œé˜¶æ®µ

#### 1. Kçº¿æ‰«æé€»è¾‘
æŒ‰æ—¶é—´é¡ºåºéå†æ¯æ ¹5åˆ†é’ŸKçº¿ï¼š

```python
for k_bar in k_line_data:
    # 1. æ£€æŸ¥ä¹°å…¥æ¡ä»¶
    if k_bar.low <= å½“å‰ä¹°å…¥ç‚¹ and å¯ç”¨èµ„é‡‘ >= ä¹°å…¥æ‰€éœ€èµ„é‡‘:
        æ‰§è¡Œä¹°å…¥()
        æ›´æ–°åŸºå‡†ä»· = å½“å‰ä¹°å…¥ç‚¹
        è®¡ç®—æ–°çš„ä¹°å–ç‚¹()
    
    # 2. æ£€æŸ¥å–å‡ºæ¡ä»¶
    elif k_bar.high >= å½“å‰å–å‡ºç‚¹ and æŒä»“è‚¡æ•° >= å•ç¬”è‚¡æ•°:
        æ‰§è¡Œå–å‡º()
        æ›´æ–°åŸºå‡†ä»· = å½“å‰å–å‡ºç‚¹
        è®¡ç®—æ–°çš„ä¹°å–ç‚¹()
    
    # 3. åŒæ—¶è§¦å‘æ—¶ä¼˜å…ˆä¹°å…¥ï¼ˆå·²ç¡®è®¤è§„åˆ™ï¼‰
    # 4. èµ„é‡‘/è‚¡æ•°ä¸è¶³æ—¶ç»§ç»­ç›‘æ§ä¸‹ä¸€ä¸ªKçº¿
```

#### 2. æˆäº¤è§„åˆ™
- **è§¦å‘æ¡ä»¶**ï¼š
  - ä¹°å…¥ï¼š`k_bar.low <= ä¹°å…¥ç‚¹ä»·æ ¼` ä¸” å¯ç”¨èµ„é‡‘å……è¶³
  - å–å‡ºï¼š`k_bar.high >= å–å‡ºç‚¹ä»·æ ¼` ä¸” æŒä»“è‚¡æ•°å……è¶³

- **æˆäº¤ä»·æ ¼**ï¼š
  - **ä¸¥æ ¼æŒ‰ç½‘æ ¼ç‚¹ä»·æ ¼æˆäº¤**ï¼ˆä¸ä½¿ç”¨Kçº¿å®é™…ä»·æ ¼ï¼‰
  - ä¹°å…¥æˆäº¤ä»· = å½“å‰ä¹°å…¥ç‚¹ä»·æ ¼
  - å–å‡ºæˆäº¤ä»· = å½“å‰å–å‡ºç‚¹ä»·æ ¼

- **æˆäº¤æ•°é‡**ï¼š
  - å•ç¬”å›ºå®šè‚¡æ•° = `single_trade_quantity`ï¼ˆä»ç½‘æ ¼ç­–ç•¥è·å–ï¼‰

- **æˆäº¤åæ›´æ–°**ï¼š
  ```python
  # ä¹°å…¥å
  æŒä»“è‚¡æ•° += å•ç¬”è‚¡æ•°
  å¯ç”¨èµ„é‡‘ -= (ä¹°å…¥ä»· Ã— å•ç¬”è‚¡æ•° Ã— (1 + æ‰‹ç»­è´¹ç‡))
  åŸºå‡†ä»· = ä¹°å…¥ä»·
  æ–°ä¹°å…¥ç‚¹ = åŸºå‡†ä»· - æ­¥é•¿
  æ–°å–å‡ºç‚¹ = åŸºå‡†ä»· + æ­¥é•¿
  
  # å–å‡ºå
  æŒä»“è‚¡æ•° -= å•ç¬”è‚¡æ•°
  å¯ç”¨èµ„é‡‘ += (å–å‡ºä»· Ã— å•ç¬”è‚¡æ•° Ã— (1 - æ‰‹ç»­è´¹ç‡))
  åŸºå‡†ä»· = å–å‡ºä»·
  æ–°ä¹°å…¥ç‚¹ = åŸºå‡†ä»· - æ­¥é•¿
  æ–°å–å‡ºç‚¹ = åŸºå‡†ä»· + æ­¥é•¿
  ```

#### 3. è¾¹ç•Œæ¡ä»¶å¤„ç†
- **èµ„é‡‘ä¸è¶³**ï¼š
  - æ— æ³•ä¹°å…¥æ—¶ï¼šç»§ç»­ç›‘æ§ï¼Œç­‰å¾…å–å‡ºé‡Šæ”¾èµ„é‡‘
  - ä¸æŠ¥é”™ï¼Œä¸åœæ­¢å›æµ‹

- **è‚¡æ•°ä¸è¶³**ï¼š
  - æ— æ³•å–å‡ºæ—¶ï¼šç»§ç»­ç›‘æ§ï¼Œç­‰å¾…ä¹°å…¥å¢åŠ æŒä»“
  - ä¸æŠ¥é”™ï¼Œä¸åœæ­¢å›æµ‹

- **ä»·æ ¼è¶…å‡ºç½‘æ ¼èŒƒå›´**ï¼š
  - è¶…å‡ºä¸Šé™ï¼šåœæ­¢ä¹°å…¥ï¼Œä»…ç›‘æ§å–å‡ºæœºä¼š
  - è·Œç ´ä¸‹é™ï¼šåœæ­¢å–å‡ºï¼Œä»…ç›‘æ§ä¹°å…¥æœºä¼š
  - ç»§ç»­è®°å½•æŒä»“å¸‚å€¼å˜åŒ–

#### 4. æ­¥é•¿è®¡ç®—
- **ç­‰å·®ç½‘æ ¼**ï¼š
  ```python
  æ­¥é•¿ = grid_config.step_size  # å›ºå®šé‡‘é¢
  ä¸‹ä¸€ä¹°å…¥ç‚¹ = åŸºå‡†ä»· - æ­¥é•¿
  ä¸‹ä¸€å–å‡ºç‚¹ = åŸºå‡†ä»· + æ­¥é•¿
  ```

- **ç­‰æ¯”ç½‘æ ¼**ï¼š
  ```python
  æ­¥é•¿æ¯”ä¾‹ = grid_config.step_ratio  # å›ºå®šæ¯”ä¾‹
  ä¸‹ä¸€ä¹°å…¥ç‚¹ = åŸºå‡†ä»· Ã— (1 - æ­¥é•¿æ¯”ä¾‹)
  ä¸‹ä¸€å–å‡ºç‚¹ = åŸºå‡†ä»· Ã— (1 + æ­¥é•¿æ¯”ä¾‹)
  ```

### æ‰‹ç»­è´¹è®¡ç®—

#### è´¹ç‡é…ç½®
- **é»˜è®¤ç»¼åˆè´¹ç‡**ï¼š0.02%ï¼ˆä¸‡åˆ†ä¹‹äºŒï¼‰
- **æœ€ä½æ”¶è´¹**ï¼š5å…ƒ
- **å¯é…ç½®æ€§**ï¼šç”¨æˆ·å¯åœ¨å›æµ‹å‚æ•°ä¸­è°ƒæ•´

#### è®¡ç®—è§„åˆ™
```python
def calculate_commission(amount: float, rate: float = 0.0002, min_fee: float = 5.0) -> float:
    """
    è®¡ç®—æ‰‹ç»­è´¹
    
    Args:
        amount: æˆäº¤é‡‘é¢
        rate: è´¹ç‡ï¼ˆé»˜è®¤0.02%ï¼‰
        min_fee: æœ€ä½æ”¶è´¹ï¼ˆé»˜è®¤5å…ƒï¼‰
    
    Returns:
        å®é™…æ‰‹ç»­è´¹
    """
    commission = amount * rate
    return max(commission, min_fee)

# ä¹°å…¥æˆæœ¬ = æˆäº¤ä»· Ã— è‚¡æ•° Ã— (1 + è´¹ç‡)ï¼Œæœ€ä½æ”¶è´¹5å…ƒ
# å–å‡ºæ”¶å…¥ = æˆäº¤ä»· Ã— è‚¡æ•° Ã— (1 - è´¹ç‡)ï¼Œæœ€ä½æ”¶è´¹5å…ƒ
```

#### æ³¨æ„äº‹é¡¹
- æš‚ä¸åŒºåˆ†ä¸åŒå¸‚åœºï¼ˆAè‚¡/æ¸¯è‚¡/ç¾è‚¡ï¼‰çš„è´¹ç‡å·®å¼‚
- æš‚ä¸å•ç‹¬è®¡ç®—å°èŠ±ç¨ã€è¿‡æˆ·è´¹ç­‰
- åç»­å¯æ‰©å±•ä¸ºæ›´ç²¾ç»†çš„åˆ†é¡¹è®¡è´¹

---

## ğŸ“Š æŒ‡æ ‡è®¡ç®—

### æ”¶ç›ŠæŒ‡æ ‡

#### 1. æ€»æ”¶ç›Šç‡
```python
æ€»æ”¶ç›Šç‡ = (æœŸæœ«æ€»èµ„äº§ - æœŸåˆæ€»èµ„äº§) / æœŸåˆæ€»èµ„äº§

æœŸåˆæ€»èµ„äº§ = æ€»æŠ•å…¥èµ„é‡‘
æœŸæœ«æ€»èµ„äº§ = å¯ç”¨èµ„é‡‘ + æŒä»“å¸‚å€¼
æŒä»“å¸‚å€¼ = æŒä»“è‚¡æ•° Ã— å›æµ‹ç»“æŸæ—¶ä»·æ ¼
```

#### 2. å¹´åŒ–æ”¶ç›Šç‡
```python
å¹´åŒ–æ”¶ç›Šç‡ = æ€»æ”¶ç›Šç‡ Ã— (å¹´äº¤æ˜“æ—¥ / å›æµ‹äº¤æ˜“æ—¥)

# å‚æ•°ï¼š
# - å¹´äº¤æ˜“æ—¥ï¼šçº¦244å¤©ï¼ˆAè‚¡ï¼‰ï¼Œå¯é…ç½®
# - å›æµ‹äº¤æ˜“æ—¥ï¼šå®é™…å›æµ‹çš„äº¤æ˜“æ—¥æ•°é‡
# 
# ç¤ºä¾‹ï¼š5ä¸ªäº¤æ˜“æ—¥ï¼Œæ€»æ”¶ç›Š2%
# å¹´åŒ–æ”¶ç›Šç‡ = 2% Ã— (244 / 5) = 97.6%
```

#### 3. ç»å¯¹æ”¶ç›Š
```python
ç»å¯¹æ”¶ç›Š = æœŸæœ«æ€»èµ„äº§ - æœŸåˆæ€»èµ„äº§
```

### é£é™©æŒ‡æ ‡

#### 1. æœ€å¤§å›æ’¤
```python
æœ€å¤§å›æ’¤ = max((å³°å€¼æ€»èµ„äº§ - å½“å‰æ€»èµ„äº§) / å³°å€¼æ€»èµ„äº§)

# è®¡ç®—æ–¹æ³•ï¼š
# 1. è®°å½•æ¯ä¸ªæ—¶é—´ç‚¹çš„æ€»èµ„äº§
# 2. ç»´æŠ¤å†å²æœ€é«˜æ€»èµ„äº§ï¼ˆå³°å€¼ï¼‰
# 3. è®¡ç®—å½“å‰å›æ’¤ = (å³°å€¼ - å½“å‰) / å³°å€¼
# 4. å–æ‰€æœ‰å›æ’¤ä¸­çš„æœ€å¤§å€¼
```

#### 2. å¤æ™®æ¯”ç‡
```python
å¤æ™®æ¯”ç‡ = (å¹´åŒ–æ”¶ç›Šç‡ - æ— é£é™©åˆ©ç‡) / æ”¶ç›Šæ³¢åŠ¨ç‡

# å‚æ•°ï¼š
# - æ— é£é™©åˆ©ç‡ï¼šé»˜è®¤3%ï¼ˆå¹´åŒ–ï¼‰ï¼Œå¯é…ç½®
# - æ”¶ç›Šæ³¢åŠ¨ç‡ = std(æ—¥æ”¶ç›Šç‡åºåˆ—) Ã— sqrt(å¹´äº¤æ˜“æ—¥)
#
# æ³¨æ„ï¼š5å¤©æ•°æ®è®¡ç®—å¤æ™®æ¯”ç‡ä»…ä¾›å‚è€ƒï¼Œæ ·æœ¬é‡è¾ƒå°
```

#### 3. æ³¢åŠ¨ç‡
```python
æ³¢åŠ¨ç‡ = std(æ—¥æ”¶ç›Šç‡åºåˆ—) Ã— sqrt(å¹´äº¤æ˜“æ—¥)

# è®¡ç®—æ­¥éª¤ï¼š
# 1. è®¡ç®—æ¯æ—¥æ”¶ç›Šç‡ = (å½“æ—¥æ€»èµ„äº§ - å‰æ—¥æ€»èµ„äº§) / å‰æ—¥æ€»èµ„äº§
# 2. è®¡ç®—æ”¶ç›Šç‡æ ‡å‡†å·®
# 3. å¹´åŒ–ï¼šä¹˜ä»¥sqrt(244)
```

### äº¤æ˜“æŒ‡æ ‡

#### 1. äº¤æ˜“æ¬¡æ•°
```python
æ€»äº¤æ˜“æ¬¡æ•° = ä¹°å…¥æ¬¡æ•° + å–å‡ºæ¬¡æ•°
ä¹°å…¥æ¬¡æ•° = len([trade for trade in trades if trade.type == 'BUY'])
å–å‡ºæ¬¡æ•° = len([trade for trade in trades if trade.type == 'SELL'])
```

#### 2. èƒœç‡
```python
èƒœç‡ = ç›ˆåˆ©äº¤æ˜“æ¬¡æ•° / æ€»äº¤æ˜“æ¬¡æ•°

# åˆ¤æ–­æ ‡å‡†ï¼ˆå«æ‰‹ç»­è´¹ï¼‰ï¼š
# å¯¹äºæ¯ç¬”ä¹°å–å¯¹ï¼š
# ç›ˆåˆ© = å–å‡ºæ”¶å…¥ - ä¹°å…¥æˆæœ¬ > 0
# 
# ç¤ºä¾‹ï¼š
# ä¹°å…¥ï¼š10å…ƒ Ã— 100è‚¡ Ã— 1.0002 = 1000.2å…ƒ
# å–å‡ºï¼š10.5å…ƒ Ã— 100è‚¡ Ã— 0.9998 = 1049.79å…ƒ
# ç›ˆåˆ© = 1049.79 - 1000.2 = 49.59å…ƒ > 0 âœ“
```

#### 3. ç›ˆäºæ¯”
```python
ç›ˆäºæ¯” = å¹³å‡ç›ˆåˆ© / å¹³å‡äºæŸ

å¹³å‡ç›ˆåˆ© = sum(ç›ˆåˆ©äº¤æ˜“é‡‘é¢) / ç›ˆåˆ©äº¤æ˜“æ¬¡æ•°
å¹³å‡äºæŸ = abs(sum(äºæŸäº¤æ˜“é‡‘é¢)) / äºæŸäº¤æ˜“æ¬¡æ•°
```

#### 4. ç½‘æ ¼è§¦å‘ç‡
```python
ç½‘æ ¼è§¦å‘ç‡ = è§¦å‘è¿‡çš„ç½‘æ ¼æ•° / æ€»ç½‘æ ¼æ•°

# ç»Ÿè®¡é€»è¾‘ï¼š
# æ ‡è®°æ¯ä¸ªç½‘æ ¼ç‚¹æ˜¯å¦è¢«è§¦å‘è¿‡ï¼ˆä¹°å…¥æˆ–å–å‡ºï¼‰
# è§¦å‘è¿‡çš„ç½‘æ ¼ = unique(å·²æˆäº¤çš„ä»·æ ¼ç‚¹)
```

### åŸºå‡†å¯¹æ¯”

#### 1. æŒæœ‰ä¸åŠ¨æ”¶ç›Šç‡
```python
æŒæœ‰ä¸åŠ¨æ”¶ç›Šç‡ = (æœŸæœ«ä»·æ ¼ - æœŸåˆä»·æ ¼) / æœŸåˆä»·æ ¼

# å‡è®¾ï¼š
# - æœŸåˆç”¨å…¨éƒ¨èµ„é‡‘ä¹°å…¥å¹¶æŒæœ‰
# - ä¸è€ƒè™‘æ‰‹ç»­è´¹ï¼ˆå¯¹æ¯”åŸºå‡†ï¼‰
# - æœŸåˆä»·æ ¼ = å›æµ‹å¼€å§‹æ—¶çš„ä»·æ ¼
# - æœŸæœ«ä»·æ ¼ = å›æµ‹ç»“æŸæ—¶çš„ä»·æ ¼
```

#### 2. è¶…é¢æ”¶ç›Š
```python
è¶…é¢æ”¶ç›Š = ç½‘æ ¼ç­–ç•¥æ”¶ç›Šç‡ - æŒæœ‰ä¸åŠ¨æ”¶ç›Šç‡

è¶…é¢æ”¶ç›Šç‡ = è¶…é¢æ”¶ç›Š / æŒæœ‰ä¸åŠ¨æ”¶ç›Šç‡
```

---

## ğŸ¨ å¯è§†åŒ–å±•ç¤º

### 1. å‚æ•°å±•ç¤ºåŒº

#### ç½‘æ ¼å‚æ•°å¡ç‰‡
- **æ€»èµ„é‡‘**ï¼šæ˜¾ç¤ºç­–ç•¥é…ç½®çš„æ€»æŠ•å…¥
- **åº•ä»“é…ç½®**ï¼š
  - åº•ä»“èµ„é‡‘é‡‘é¢
  - åº•ä»“è‚¡æ•°
  - åº•ä»“æ¯”ä¾‹
- **ç½‘æ ¼é…ç½®**ï¼š
  - ä»·æ ¼åŒºé—´ï¼š[ä¸‹é™, ä¸Šé™]
  - ç½‘æ ¼ç±»å‹ï¼šç­‰å·®/ç­‰æ¯”
  - ç½‘æ ¼æ­¥é•¿ï¼šé‡‘é¢æˆ–æ¯”ä¾‹
  - ç½‘æ ¼æ•°é‡
- **äº¤æ˜“æˆæœ¬**ï¼š
  - æ‰‹ç»­è´¹ç‡ï¼ˆå¯ç¼–è¾‘ï¼‰
  - æœ€ä½æ”¶è´¹ï¼ˆå¯ç¼–è¾‘ï¼‰
- **å›æµ‹åŒºé—´**ï¼š
  - å¼€å§‹æ—¥æœŸ - ç»“æŸæ—¥æœŸ
  - äº¤æ˜“æ—¥å¤©æ•°

### 2. æŒ‡æ ‡æ¦‚è§ˆåŒº

#### æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ï¼ˆ4åˆ—å¸ƒå±€ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»æ”¶ç›Šç‡  â”‚ å¹´åŒ–æ”¶ç›Š  â”‚ æœ€å¤§å›æ’¤  â”‚ å¤æ™®æ¯”ç‡  â”‚
â”‚ +5.2%   â”‚ 38.5%   â”‚ -2.3%   â”‚ 1.85    â”‚
â”‚ â–² è¶…é¢3% â”‚         â”‚         â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### äº¤æ˜“ç»Ÿè®¡ï¼ˆæ¬¡è¦æŒ‡æ ‡ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº¤æ˜“æ¬¡æ•°   â”‚ èƒœç‡      â”‚ ç›ˆäºæ¯”    â”‚ ç½‘æ ¼è§¦å‘ç‡ â”‚
â”‚ 24æ¬¡      â”‚ 62.5%    â”‚ 1.8      â”‚ 45.2%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. å›æµ‹è§†å›¾ï¼ˆåŒå›¾è¡¨ï¼‰

#### ä¸»å›¾ï¼šæ ‡çš„è¡Œæƒ… & ä¹°å–ç‚¹ä½
- **Xè½´**ï¼šæ—¶é—´ï¼ˆ5åˆ†é’Ÿç²’åº¦ï¼‰
- **Yè½´**ï¼šä»·æ ¼
- **æŠ˜çº¿å›¾**ï¼š
  - æ”¶ç›˜ä»·æŠ˜çº¿ï¼ˆè“è‰²ï¼‰
  - Tooltipæ˜¾ç¤ºï¼šæ—¥æœŸã€å¼€é«˜ä½æ”¶ã€æˆäº¤é‡
- **æ ‡æ³¨ç‚¹**ï¼š
  - ä¹°å…¥ç‚¹ï¼šçº¢è‰²å‘ä¸Šç®­å¤´ â†‘
  - å–å‡ºç‚¹ï¼šè“è‰²å‘ä¸‹ç®­å¤´ â†“
  - Tooltipæ˜¾ç¤ºï¼šæˆäº¤æ—¶é—´ã€ä»·æ ¼ã€æ•°é‡ã€ç›ˆäº
- **è¾…åŠ©çº¿**ï¼š
  - ä»·æ ¼ä¸Šé™ï¼ˆè™šçº¿ï¼Œçº¢è‰²ï¼‰
  - ä»·æ ¼ä¸‹é™ï¼ˆè™šçº¿ï¼Œç»¿è‰²ï¼‰
  - åˆå§‹åŸºå‡†ä»·ï¼ˆè™šçº¿ï¼Œç°è‰²ï¼‰

#### å‰¯å›¾ï¼šæ”¶ç›Šæ›²çº¿å¯¹æ¯”
- **Xè½´**ï¼šæ—¶é—´
- **Yè½´**ï¼šæ”¶ç›Šç‡ï¼ˆ%ï¼‰
- **ä¸‰æ¡æ›²çº¿**ï¼š
  - ç½‘æ ¼ç­–ç•¥æ”¶ç›Šï¼ˆè“è‰²å®çº¿ï¼‰
  - æŒæœ‰ä¸åŠ¨æ”¶ç›Šï¼ˆç°è‰²è™šçº¿ï¼‰
  - è¶…é¢æ”¶ç›Šï¼ˆç»¿è‰²å¡«å……åŒºåŸŸï¼‰

### 4. äº¤æ˜“è®°å½•è¡¨æ ¼

#### è¡¨å¤´
```
| æ—¶é—´ | ç±»å‹ | ä»·æ ¼ | æ•°é‡ | æ‰‹ç»­è´¹ | ç›ˆäº | æŒä»“ | èµ„é‡‘ä½™é¢ |
```

#### ç­›é€‰å™¨
- [å…¨éƒ¨] [ä¹°å…¥] [å–å‡º]
- æ”¯æŒæŒ‰ç±»å‹ç­›é€‰

#### ç¤ºä¾‹æ•°æ®
```
| 2025-01-15 10:05 | ä¹°å…¥ | 3.500 | 500è‚¡ | 0.35å…ƒ | -     | 1500è‚¡ | 8,249.65å…ƒ |
| 2025-01-15 14:20 | å–å‡º | 3.550 | 500è‚¡ | 0.36å…ƒ | +24.14å…ƒ | 1000è‚¡ | 10,024.29å…ƒ |
```

#### é¢œè‰²æ ‡è¯†
- ä¹°å…¥è¡Œï¼šæµ…çº¢è‰²èƒŒæ™¯
- å–å‡ºè¡Œï¼šæµ…è“è‰²èƒŒæ™¯
- ç›ˆåˆ©ï¼šçº¢è‰²æ–‡å­—
- äºæŸï¼šç»¿è‰²æ–‡å­—

### 5. ç½‘æ ¼è¡¨ç°åˆ†æ

#### ç½‘æ ¼çƒ­åŠ›å›¾ï¼ˆå¯é€‰ï¼‰
- æ˜¾ç¤ºå„ç½‘æ ¼çš„è§¦å‘æ¬¡æ•°
- é¢œè‰²æ·±åº¦è¡¨ç¤ºè§¦å‘é¢‘ç‡
- æç¤ºå„ç½‘æ ¼çš„ç›ˆåˆ©è´¡çŒ®

#### ç½‘æ ¼ç»Ÿè®¡è¡¨
```
| ç½‘æ ¼ä»·æ ¼ | è§¦å‘æ¬¡æ•° | ç›ˆåˆ©è´¡çŒ® | è§¦å‘ç‡ |
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯ç»“æ„

```
backend/app/
â”œâ”€â”€ algorithms/backtest/          # å›æµ‹ç®—æ³•æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ engine.py                 # å›æµ‹å¼•æ“æ ¸å¿ƒ
â”‚   â”œâ”€â”€ metrics.py                # æŒ‡æ ‡è®¡ç®—å™¨
â”‚   â”œâ”€â”€ trading_logic.py          # äº¤æ˜“é€»è¾‘
â”‚   â””â”€â”€ fee_calculator.py         # æ‰‹ç»­è´¹è®¡ç®—å™¨
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ data_service.py           # æ‰©å±•ï¼šæ·»åŠ get_5min_dataæ–¹æ³•
â”‚   â””â”€â”€ backtest_service.py       # æ–°å¢ï¼šå›æµ‹ä¸šåŠ¡æœåŠ¡
â”‚
â””â”€â”€ routes/
    â””â”€â”€ grid_routes.py            # æ‰©å±•ï¼šæ·»åŠ /api/grid/backtestç«¯ç‚¹
```

### å‰ç«¯ç»“æ„

```
frontend/src/features/analysis/components/
â”œâ”€â”€ ReportTabs.jsx                # ä¿®æ”¹ï¼šæ·»åŠ "å›æµ‹åˆ†æ"æ ‡ç­¾
â”œâ”€â”€ AnalysisReport.jsx            # ä¿®æ”¹ï¼šæ·»åŠ BacktestTabæ¸²æŸ“
â”œâ”€â”€ BacktestTab.jsx               # æ–°å¢ï¼šå›æµ‹æ ‡ç­¾é¡µå®¹å™¨
â”‚
â””â”€â”€ backtest/                     # æ–°å¢ï¼šå›æµ‹å­ç»„ä»¶ç›®å½•
    â”œâ”€â”€ BacktestMetrics.jsx       # æŒ‡æ ‡å¡ç‰‡ç»„ä»¶
    â”œâ”€â”€ BacktestCharts.jsx        # å›¾è¡¨ç»„ä»¶ï¼ˆå«åŒå›¾è¡¨ï¼‰
    â”œâ”€â”€ TradeList.jsx             # äº¤æ˜“è®°å½•åˆ—è¡¨
    â””â”€â”€ GridPerformance.jsx       # ç½‘æ ¼è¡¨ç°åˆ†æ
```

---

## ğŸ”„ æ•°æ®æµç¨‹

### å®Œæ•´æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·åˆ‡æ¢åˆ°å›æµ‹æ ‡ç­¾é¡µ] --> B[å±•ç¤ºç½‘æ ¼å‚æ•°]
    B --> C{å‚æ•°æ˜¯å¦éœ€è¦è°ƒæ•´?}
    C -->|æ˜¯| D[ç”¨æˆ·ç¼–è¾‘å‚æ•°]
    C -->|å¦| E[ç‚¹å‡»å¼€å§‹å›æµ‹]
    D --> E
    E --> F[å‰ç«¯å‘é€å›æµ‹è¯·æ±‚]
    F --> G[åç«¯è·å–äº¤æ˜“æ—¥å†]
    G --> H[ç¡®å®šå›æµ‹æ—¥æœŸèŒƒå›´]
    H --> I[è·å–5åˆ†é’ŸKçº¿æ•°æ®]
    I --> J[å›æµ‹å¼•æ“åˆå§‹åŒ–]
    J --> K[æ‰§è¡Œåˆå§‹å»ºä»“]
    K --> L[é€Kçº¿æ‰«æäº¤æ˜“]
    L --> M[è®¡ç®—æ€§èƒ½æŒ‡æ ‡]
    M --> N[è¿”å›å›æµ‹ç»“æœ]
    N --> O[å‰ç«¯æ¸²æŸ“å›¾è¡¨å’Œæ•°æ®]
```

### APIäº¤äº’

#### è¯·æ±‚æ¥å£
```
POST /api/grid/backtest
```

#### è¯·æ±‚å‚æ•°
```json
{
  "etfCode": "510300",
  "gridStrategy": {
    "current_price": 3.500,
    "price_range": {
      "lower": 3.200,
      "upper": 3.800
    },
    "grid_config": {
      "count": 20,
      "type": "ç­‰å·®",
      "step_size": 0.030,
      "step_ratio": 0.0086
    },
    "price_levels": [3.200, 3.230, ...],
    "fund_allocation": {
      "base_position_amount": 2500.00,
      "base_position_shares": 700,
      "grid_trading_amount": 7000.00,
      "single_trade_quantity": 100
    }
  },
  "backtestConfig": {
    "commissionRate": 0.0002,    // æ‰‹ç»­è´¹ç‡ï¼ˆå¯è°ƒï¼‰
    "minCommission": 5.0,        // æœ€ä½æ”¶è´¹ï¼ˆå¯è°ƒï¼‰
    "riskFreeRate": 0.03,        // æ— é£é™©åˆ©ç‡ï¼ˆå¯è°ƒï¼‰
    "tradingDaysPerYear": 244    // å¹´äº¤æ˜“æ—¥æ•°ï¼ˆå¯è°ƒï¼‰
  }
}
```

#### å“åº”æ•°æ®
```json
{
  "success": true,
  "data": {
    "backtest_period": {
      "start_date": "2025-01-10",
      "end_date": "2025-01-16",
      "trading_days": 5,
      "total_bars": 240
    },
    "performance_metrics": {
      "total_return": 0.052,
      "annualized_return": 0.385,
      "absolute_profit": 520.00,
      "max_drawdown": -0.023,
      "sharpe_ratio": 1.85,
      "volatility": 0.156
    },
    "trading_metrics": {
      "total_trades": 24,
      "buy_trades": 12,
      "sell_trades": 12,
      "win_rate": 0.625,
      "profit_loss_ratio": 1.8,
      "grid_trigger_rate": 0.452
    },
    "benchmark_comparison": {
      "hold_return": 0.022,
      "excess_return": 0.030,
      "excess_return_rate": 1.364
    },
    "equity_curve": [
      {
        "time": "2025-01-10 09:35:00",
        "total_asset": 10000.00,
        "grid_return": 0.0,
        "hold_return": 0.0
      },
      ...
    ],
    "price_curve": [
      {
        "time": "2025-01-10 09:35:00",
        "open": 3.500,
        "high": 3.510,
        "low": 3.495,
        "close": 3.505,
        "volume": 12500
      },
      ...
    ],
    "trade_records": [
      {
        "time": "2025-01-10 10:05:00",
        "type": "BUY",
        "price": 3.470,
        "quantity": 100,
        "commission": 0.35,
        "profit": null,
        "position": 800,
        "cash": 9,649.65
      },
      {
        "time": "2025-01-10 14:20:00",
        "type": "SELL",
        "price": 3.500,
        "quantity": 100,
        "commission": 0.35,
        "profit": 2.30,
        "position": 700,
        "cash": 9,999.60
      },
      ...
    ],
    "grid_analysis": {
      "triggered_grids": 9,
      "total_grids": 20,
      "grid_performance": [
        {
          "price": 3.470,
          "trigger_count": 3,
          "profit_contribution": 15.60
        },
        ...
      ]
    },
    "final_state": {
      "cash": 10,520.00,
      "position": 700,
      "position_value": 2,450.00,
      "total_asset": 12,970.00
    }
  }
}
```

---

## âš ï¸ è¾¹ç•Œæƒ…å†µå¤„ç†

### æ•°æ®å¼‚å¸¸

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| è·å–Kçº¿æ•°æ®å¤±è´¥ | è¿”å›é”™è¯¯æç¤ºï¼Œå»ºè®®ç”¨æˆ·ç¨åé‡è¯• |
| æ•°æ®ä¸è¶³5å¤© | æ˜¾ç¤ºè­¦å‘Šï¼Œä½¿ç”¨å®é™…å¤©æ•°è¿›è¡Œå›æµ‹ |
| Kçº¿æ•°æ®æœ‰ç¼ºå¤± | è·³è¿‡ç¼ºå¤±çš„æ—¶é—´ç‚¹ï¼Œç»§ç»­å›æµ‹ |
| ä»·æ ¼å¼‚å¸¸æ³¢åŠ¨ï¼ˆå¦‚åœç‰Œå¤ç‰Œè·³ç©ºï¼‰ | æ­£å¸¸å¤„ç†ï¼ŒæŒ‰ç½‘æ ¼ä»·æˆäº¤ |

### äº¤æ˜“å¼‚å¸¸

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| èµ„é‡‘ä¸è¶³æ— æ³•ä¹°å…¥ | è·³è¿‡è¯¥äº¤æ˜“ï¼Œç»§ç»­ç›‘æ§ |
| è‚¡æ•°ä¸è¶³æ— æ³•å–å‡º | è·³è¿‡è¯¥äº¤æ˜“ï¼Œç»§ç»­ç›‘æ§ |
| ä»·æ ¼è¶…å‡ºç½‘æ ¼ä¸Šé™ | åœæ­¢ä¹°å–ï¼Œç»§ç»­ç›‘æ§ä»·æ ¼ |
| ä»·æ ¼è·Œç ´ç½‘æ ¼ä¸‹é™ | åœæ­¢ä¹°å–ï¼Œç»§ç»­ç›‘æ§ä»·æ ¼ |
| åŒæ—¶è§¦å‘ä¹°å– | ä¼˜å…ˆæ‰§è¡Œä¹°å…¥ |

### è®¡ç®—å¼‚å¸¸

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| å¤æ™®æ¯”ç‡åˆ†æ¯ä¸º0 | è¿”å›nullæˆ–N/A |
| èƒœç‡åˆ†æ¯ä¸º0ï¼ˆæ— äº¤æ˜“ï¼‰ | è¿”å›0% |
| ç›ˆäºæ¯”åˆ†æ¯ä¸º0ï¼ˆæ— äºæŸï¼‰ | è¿”å›æ­£æ— ç©·æˆ–ç‰¹æ®Šæ ‡è®° |
| æ”¶ç›Šç‡è®¡ç®—æº¢å‡º | é™åˆ¶æœ€å¤§å€¼ï¼ˆå¦‚Â±1000%ï¼‰ |

### å‚æ•°å¼‚å¸¸

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| æ‰‹ç»­è´¹ç‡ < 0 æˆ– > 1 | ä½¿ç”¨é»˜è®¤å€¼0.02% |
| æœ€ä½æ”¶è´¹ < 0 | ä½¿ç”¨é»˜è®¤å€¼5å…ƒ |
| æ— é£é™©åˆ©ç‡å¼‚å¸¸ | ä½¿ç”¨é»˜è®¤å€¼3% |
| ç½‘æ ¼å‚æ•°ç¼ºå¤± | è¿”å›é”™è¯¯ï¼Œè¦æ±‚é‡æ–°ç”Ÿæˆç­–ç•¥ |

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®å¤„ç†

1. **æ•°æ®ç¼“å­˜**ï¼š
   - Kçº¿æ•°æ®æŒ‰æ—¥æœŸ+æ ‡çš„ç¼“å­˜ï¼ˆæœ‰æ•ˆæœŸ1å°æ—¶ï¼‰
   - å‡å°‘é‡å¤APIè°ƒç”¨

2. **æ‰¹é‡è®¡ç®—**ï¼š
   - æ”¶ç›Šæ›²çº¿ã€æŒ‡æ ‡ç»Ÿè®¡ä½¿ç”¨å‘é‡åŒ–è®¡ç®—
   - é¿å…é€æ¡éå†

3. **å¼‚æ­¥å¤„ç†**ï¼š
   - å›æµ‹è®¡ç®—åœ¨åå°çº¿ç¨‹æ‰§è¡Œ
   - é¿å…é˜»å¡ä¸»çº¿ç¨‹

### å‰ç«¯ä¼˜åŒ–

1. **å›¾è¡¨æ€§èƒ½**ï¼š
   - è¶…è¿‡500ä¸ªæ•°æ®ç‚¹æ—¶å¯ç”¨æ•°æ®æŠ½æ ·
   - ä½¿ç”¨Canvasæ¸²æŸ“ä»£æ›¿SVG

2. **æ•°æ®åˆ†é¡µ**ï¼š
   - äº¤æ˜“è®°å½•é»˜è®¤æ˜¾ç¤ºå‰50æ¡
   - æ”¯æŒåˆ†é¡µåŠ è½½

3. **æ‡’åŠ è½½**ï¼š
   - ç½‘æ ¼åˆ†æç­‰æ¬¡è¦æ¨¡å—æŒ‰éœ€åŠ è½½

---

## ğŸ’¡ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### åŠ è½½çŠ¶æ€

1. **è¿›åº¦æŒ‡ç¤º**ï¼š
   ```
   å›æµ‹ä¸­... å·²å®Œæˆ 60% (3/5ä¸ªäº¤æ˜“æ—¥)
   ```

2. **å„é˜¶æ®µæç¤º**ï¼š
   - è·å–äº¤æ˜“æ—¥å†...
   - åŠ è½½Kçº¿æ•°æ®...
   - æ‰§è¡Œå›æµ‹è®¡ç®—...
   - ç”Ÿæˆåˆ†ææŠ¥å‘Š...

### é”™è¯¯å¤„ç†

1. **å‹å¥½æç¤º**ï¼š
   - âŒ "æ— æ³•è·å–Kçº¿æ•°æ®ï¼Œè¯·ç¨åé‡è¯•"
   - âš ï¸ "æ•°æ®ä¸è¶³5å¤©ï¼Œä½¿ç”¨å®é™…3å¤©æ•°æ®å›æµ‹"

2. **æ“ä½œå¼•å¯¼**ï¼š
   - é¦–æ¬¡ä½¿ç”¨æ—¶æ˜¾ç¤ºåŠŸèƒ½è¯´æ˜
   - å…³é”®å‚æ•°æä¾›å·¥å…·æç¤º

### ç»“æœè§£è¯»

1. **æŒ‡æ ‡è¯´æ˜**ï¼š
   - æ¯ä¸ªæŒ‡æ ‡æ—æ˜¾ç¤ºï¼Ÿå›¾æ ‡
   - æ‚¬æµ®æ˜¾ç¤ºè®¡ç®—æ–¹æ³•å’Œå«ä¹‰

2. **å¯¹æ¯”å‚è€ƒ**ï¼š
   - æ˜¾ç¤ºè¡Œä¸šå¹³å‡å€¼ï¼ˆå¦‚å¯ç”¨ï¼‰
   - çªå‡ºä¼˜äºåŸºå‡†çš„éƒ¨åˆ†

---

## âœ… å¼€å‘æ£€æŸ¥æ¸…å•

### åç«¯å¼€å‘
- [ ] åˆ›å»ºå›æµ‹å¼•æ“æ¨¡å—ï¼ˆ`BacktestEngine`ï¼‰
- [ ] å®ç°äº¤æ˜“é€»è¾‘ï¼ˆä¹°å–åˆ¤æ–­ã€æˆäº¤æ‰§è¡Œï¼‰
- [ ] å®ç°æŒ‡æ ‡è®¡ç®—å™¨ï¼ˆæ”¶ç›Šã€é£é™©ã€äº¤æ˜“æŒ‡æ ‡ï¼‰
- [ ] å®ç°æ‰‹ç»­è´¹è®¡ç®—å™¨ï¼ˆæ”¯æŒå¯é…ç½®å‚æ•°ï¼‰
- [ ] æ‰©å±•`DataService`è·å–5åˆ†é’Ÿæ•°æ®
- [ ] åˆ›å»º`BacktestService`åè°ƒä¸šåŠ¡æµç¨‹
- [ ] æ·»åŠ APIç«¯ç‚¹`/api/grid/backtest`
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆæ ¸å¿ƒç®—æ³•è¦†ç›–ç‡>80%ï¼‰
- [ ] ç¼–å†™é›†æˆæµ‹è¯•ï¼ˆå®Œæ•´æµç¨‹æµ‹è¯•ï¼‰

### å‰ç«¯å¼€å‘
- [ ] ä¿®æ”¹`ReportTabs`æ·»åŠ "å›æµ‹åˆ†æ"æ ‡ç­¾
- [ ] åˆ›å»º`BacktestTab`å®¹å™¨ç»„ä»¶
- [ ] å®ç°æŒ‡æ ‡å¡ç‰‡ç»„ä»¶ï¼ˆ`BacktestMetrics`ï¼‰
- [ ] å®ç°å›¾è¡¨ç»„ä»¶ï¼ˆ`BacktestCharts`ï¼‰
  - [ ] ä¸»å›¾ï¼šä»·æ ¼èµ°åŠ¿+ä¹°å–ç‚¹
  - [ ] å‰¯å›¾ï¼šæ”¶ç›Šæ›²çº¿å¯¹æ¯”
- [ ] å®ç°äº¤æ˜“è®°å½•è¡¨æ ¼ï¼ˆ`TradeList`ï¼‰
- [ ] å®ç°ç½‘æ ¼è¡¨ç°åˆ†æï¼ˆ`GridPerformance`ï¼‰
- [ ] æ·»åŠ å‚æ•°ç¼–è¾‘åŠŸèƒ½
- [ ] æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†
- [ ] å“åº”å¼é€‚é…ï¼ˆç§»åŠ¨ç«¯ï¼‰

### è”è°ƒæµ‹è¯•
- [ ] APIåŠŸèƒ½éªŒè¯
- [ ] æ•°æ®å‡†ç¡®æ€§æµ‹è¯•ï¼ˆå¯¹æ¯”æ‰‹å·¥è®¡ç®—ï¼‰
- [ ] è¾¹ç•Œæƒ…å†µæµ‹è¯•ï¼ˆå¼‚å¸¸æ•°æ®ã€æç«¯å‚æ•°ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå¤§æ•°æ®é‡ã€å¹¶å‘è¯·æ±‚ï¼‰
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•ï¼ˆæ“ä½œæµç¨‹ã€ç•Œé¢å‹å¥½åº¦ï¼‰

---

## ğŸ”® åç»­ä¼˜åŒ–æ–¹å‘

### åŠŸèƒ½æ‰©å±•

1. **å¤šå‘¨æœŸå›æµ‹**ï¼š
   - æ”¯æŒ1å¤©ã€5å¤©ã€10å¤©ã€30å¤©ã€90å¤©ç­‰
   - ç”¨æˆ·å¯è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´

2. **å‚æ•°ä¼˜åŒ–**ï¼š
   - åŸºäºå›æµ‹ç»“æœæ¨èæœ€ä¼˜å‚æ•°
   - ç½‘æ ¼æ­¥é•¿ã€åº•ä»“æ¯”ä¾‹ç­‰è‡ªåŠ¨ä¼˜åŒ–

3. **ç­–ç•¥å¯¹æ¯”**ï¼š
   - åŒæ—¶å›æµ‹å¤šä¸ªç­–ç•¥æ–¹æ¡ˆ
   - å¹¶æ’å±•ç¤ºå¯¹æ¯”ç»“æœ

4. **æŠ¥å‘Šå¯¼å‡º**ï¼š
   - æ”¯æŒPDFæ ¼å¼å¯¼å‡º
   - æ”¯æŒExcelæ ¼å¼å¯¼å‡ºäº¤æ˜“æ˜ç»†

5. **å®ç›˜å¯¹æ¥**ï¼ˆé•¿æœŸï¼‰ï¼š
   - å›æµ‹ç­–ç•¥ä¸€é”®è½¬å®ç›˜
   - å®ç›˜è·Ÿè¸ªä¸å›æµ‹å¯¹æ¯”

### ç®—æ³•ä¼˜åŒ–

1. **æ›´ç²¾ç»†çš„æˆäº¤æ¨¡æ‹Ÿ**ï¼š
   - è€ƒè™‘æˆäº¤é‡é™åˆ¶
   - è€ƒè™‘æ»‘ç‚¹å½±å“

2. **åŠ¨æ€ç½‘æ ¼è°ƒæ•´**ï¼š
   - æ ¹æ®å¸‚åœºæ³¢åŠ¨è‡ªåŠ¨è°ƒæ•´ç½‘æ ¼
   - è¶‹åŠ¿è¯†åˆ«ä¸ç½‘æ ¼åˆ‡æ¢

3. **é£é™©é¢„è­¦**ï¼š
   - å›æ’¤è¾¾åˆ°é˜ˆå€¼æ—¶é¢„è­¦
   - æç«¯è¡Œæƒ…é£é™©æç¤º

### æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜ç­–ç•¥**ï¼š
   - ç›¸åŒå‚æ•°ç»“æœç¼“å­˜7å¤©
   - æ”¯æŒç»“æœé¢„åŠ è½½

2. **å¹¶è¡Œè®¡ç®—**ï¼š
   - å¤šç­–ç•¥å¯¹æ¯”æ—¶å¹¶è¡Œå›æµ‹
   - å¤§æ•°æ®é‡åˆ†æ®µå¹¶è¡Œ

3. **æ•°æ®å‹ç¼©**ï¼š
   - Kçº¿æ•°æ®å‹ç¼©ä¼ è¾“
   - å‡å°‘50%ç½‘ç»œè´Ÿè½½

---

## â“ å¾…ç¡®è®¤äº‹é¡¹ï¼ˆå·²è§£å†³ï¼‰

### å·²ç¡®è®¤ âœ…

| å†³ç­–é¡¹ | ç¡®è®¤æ–¹æ¡ˆ |
|--------|---------|
| ğŸ“Š åˆå§‹å»ºä»“ | æŒ‰ç­–ç•¥åŸºå‡†ä»·ä¸€æ¬¡æ€§å»ºä»“ï¼Œå»ºä»“åæŒ‰ç½‘æ ¼è§„åˆ™äº¤æ˜“ |
| ğŸ’° æˆäº¤ä»·æ ¼ | **ä¸¥æ ¼æŒ‰ç½‘æ ¼ç‚¹ä»·æ ¼æˆäº¤**ï¼Œä¸ä½¿ç”¨Kçº¿å®é™…ä»·æ ¼ |
| ğŸ”„ ä»·æ ¼åç¦» | é‡‡ç”¨å€æ•°æˆäº¤æœºåˆ¶ï¼Œæ ¹æ®åç¦»æ¡£ä½è®¡ç®—æˆäº¤å€æ•° |
| âš ï¸ èµ„é‡‘ä¸è¶³ | ç»§ç»­ç›‘æ§ï¼Œä¸æŠ¥é”™ï¼Œç­‰å¾…é‡Šæ”¾èµ„é‡‘ |
| âš ï¸ è‚¡æ•°ä¸è¶³ | ç»§ç»­ç›‘æ§ï¼Œä¸æŠ¥é”™ï¼Œç­‰å¾…å¢åŠ æŒä»“ |
| ğŸ”€ åŒæ—¶è§¦å‘ | ä¼˜å…ˆæ‰§è¡Œä¹°å…¥ |
| ğŸ“ˆ å¹´åŒ–æ”¶ç›Šç‡ | æŒ‰å¹´äº¤æ˜“æ—¥æŠ˜ç®—ï¼ˆçº¦244å¤©ï¼‰ï¼Œæ”¯æŒæ‰©å±•åˆ°æ›´é•¿å‘¨æœŸ |
| ğŸ“‰ å¤æ™®æ¯”ç‡ | æ— é£é™©åˆ©ç‡3%ï¼ˆå¯è°ƒï¼‰ï¼Œå°æ ·æœ¬ä»…ä¾›å‚è€ƒ |
| ğŸ¯ èƒœç‡è®¡ç®— | åŸºäºå«æ‰‹ç»­è´¹çš„å®é™…ç›ˆäº |
| ğŸ’µ æ‰‹ç»­è´¹ | ç»¼åˆè´¹ç‡0.02%ï¼Œæœ€ä½5å…ƒï¼Œå¯è°ƒæ•´ |
| ğŸ“… å›æµ‹å‘¨æœŸ | å½“å‰5ä¸ªäº¤æ˜“æ—¥ï¼Œåç«¯å¯é…ç½® |
| ğŸ¨ å›¾è¡¨åº“ | **Recharts** - Reactç”Ÿæ€æˆç†Ÿï¼Œä½“ç§¯é€‚ä¸­ |
| âš™ï¸ å‚æ•°ç¼–è¾‘ | å›æµ‹å‰å…è®¸è°ƒæ•´æ‰‹ç»­è´¹ç‡ã€æœ€ä½æ”¶è´¹ç­‰å‚æ•° |

---

## ğŸ“ é™„å½•

### A. æ•°æ®ç»“æ„å®šä¹‰

#### ç½‘æ ¼ç­–ç•¥å‚æ•°ï¼ˆè¾“å…¥ï¼‰
```typescript
interface GridStrategy {
  current_price: number;
  price_date: string;
  price_range: {
    lower: number;
    upper: number;
    ratio: number;
  };
  grid_config: {
    count: number;
    type: 'ç­‰å·®' | 'ç­‰æ¯”';
    step_size: number;
    step_ratio: number;
  };
  price_levels: number[];
  fund_allocation: {
    base_position_amount: number;
    base_position_shares: number;
    grid_trading_amount: number;
    single_trade_quantity: number;
  };
}
```

#### å›æµ‹é…ç½®ï¼ˆè¾“å…¥ï¼‰
```typescript
interface BacktestConfig {
  commissionRate: number;      // æ‰‹ç»­è´¹ç‡
  minCommission: number;        // æœ€ä½æ”¶è´¹
  riskFreeRate: number;         // æ— é£é™©åˆ©ç‡
  tradingDaysPerYear: number;   // å¹´äº¤æ˜“æ—¥æ•°
}
```

#### å›æµ‹ç»“æœï¼ˆè¾“å‡ºï¼‰
```typescript
interface BacktestResult {
  backtest_period: {
    start_date: string;
    end_date: string;
    trading_days: number;
    total_bars: number;
  };
  performance_metrics: {
    total_return: number;
    annualized_return: number;
    absolute_profit: number;
    max_drawdown: number;
    sharpe_ratio: number;
    volatility: number;
  };
  trading_metrics: {
    total_trades: number;
    buy_trades: number;
    sell_trades: number;
    win_rate: number;
    profit_loss_ratio: number;
    grid_trigger_rate: number;
  };
  benchmark_comparison: {
    hold_return: number;
    excess_return: number;
    excess_return_rate: number;
  };
  equity_curve: EquityPoint[];
  price_curve: PriceBar[];
  trade_records: TradeRecord[];
  grid_analysis: GridAnalysis;
  final_state: FinalState;
}
```

### B. è®¡ç®—å…¬å¼é€ŸæŸ¥

| æŒ‡æ ‡ | å…¬å¼ |
|------|------|
| æ€»æ”¶ç›Šç‡ | `(æœŸæœ«æ€»èµ„äº§ - æœŸåˆæ€»èµ„äº§) / æœŸåˆæ€»èµ„äº§` |
| å¹´åŒ–æ”¶ç›Šç‡ | `æ€»æ”¶ç›Šç‡ Ã— (244 / å›æµ‹å¤©æ•°)` |
| æœ€å¤§å›æ’¤ | `max((å³°å€¼ - å½“å‰) / å³°å€¼)` |
| å¤æ™®æ¯”ç‡ | `(å¹´åŒ–æ”¶ç›Šç‡ - 3%) / æ³¢åŠ¨ç‡` |
| æ³¢åŠ¨ç‡ | `std(æ—¥æ”¶ç›Šç‡) Ã— sqrt(244)` |
| èƒœç‡ | `ç›ˆåˆ©äº¤æ˜“æ•° / æ€»äº¤æ˜“æ•°` |
| ç›ˆäºæ¯” | `å¹³å‡ç›ˆåˆ© / å¹³å‡äºæŸ` |
| ç½‘æ ¼è§¦å‘ç‡ | `è§¦å‘ç½‘æ ¼æ•° / æ€»ç½‘æ ¼æ•°` |
| æŒæœ‰æ”¶ç›Šç‡ | `(æœŸæœ«ä»· - æœŸåˆä»·) / æœŸåˆä»·` |
| è¶…é¢æ”¶ç›Š | `ç½‘æ ¼æ”¶ç›Šç‡ - æŒæœ‰æ”¶ç›Šç‡` |

### C. æµ‹è¯•ç”¨ä¾‹å‚è€ƒ

#### æ­£å¸¸åœºæ™¯
- ä»·æ ¼åœ¨ç½‘æ ¼å†…æ­£å¸¸æ³¢åŠ¨
- å¤šæ¬¡ä¹°å–æˆäº¤
- ç¬¦åˆé¢„æœŸçš„æ”¶ç›Šè¡¨ç°

#### æç«¯åœºæ™¯
- ä»·æ ¼å•è¾¹ä¸Šæ¶¨ï¼ˆè§¦åŠä¸Šé™ï¼‰
- ä»·æ ¼å•è¾¹ä¸‹è·Œï¼ˆè§¦åŠä¸‹é™ï¼‰
- ä»·æ ¼å‰§çƒˆéœ‡è¡
- ä»·æ ¼é•¿æœŸæ¨ªç›˜

#### å¼‚å¸¸åœºæ™¯
- æ•°æ®ç¼ºå¤±
- ç½‘ç»œè¶…æ—¶
- å‚æ•°å¼‚å¸¸
- å¹¶å‘è¯·æ±‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**æœ€åæ›´æ–°**ï¼š2025-01-07  
**ç»´æŠ¤è€…**ï¼šæ¶æ„å›¢é˜Ÿ
